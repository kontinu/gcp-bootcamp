
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="GCP Bootcamp.">
      
      
      
        <meta name="author" content="Marcos Cano">
      
      
      <link rel="icon" href="../static/images/brain.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.2">
    
    
      
        <title>Lab 4Ô∏è‚É£ (CloudRun üèÉ‚Äç‚ôÇÔ∏è) - gcp.bootcamp</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.24c991ad.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Space+Mono:300,400,400i,700%7CInconsolata&display=fallback">
        <style>:root{--md-text-font-family:"Space Mono";--md-code-font-family:"Inconsolata"}</style>
      
    
    
    
      <link rel="stylesheet" href="../static/css/extra.css">
    
      <link rel="stylesheet" href="../static/css/contact_form.css">
    
      <link rel="stylesheet" href="https://unpkg.com/mermaid/dist/mermaid.css">
    
      <link rel="stylesheet" href="../static/css/asciinema-player.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="deep-orange">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cloud-run" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="gcp.bootcamp" class="md-header__button md-logo" aria-label="gcp.bootcamp" data-md-component="logo">
      
  <img src="../static/img/google-cloud.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            gcp.bootcamp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 4Ô∏è‚É£ (CloudRun üèÉ‚Äç‚ôÇÔ∏è)
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/kontinu/gcp-bootcamp.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gcp.bootcamp
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="gcp.bootcamp" class="md-nav__button md-logo" aria-label="gcp.bootcamp" data-md-component="logo">
      
  <img src="../static/img/google-cloud.png" alt="logo">

    </a>
    gcp.bootcamp
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/kontinu/gcp-bootcamp.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gcp.bootcamp
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home üè†
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Labs üß™
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Labs üß™" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Labs üß™
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../labs/" class="md-nav__link">
        Home üè†
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1.gcs-www/" class="md-nav__link">
        Lab 1Ô∏è‚É£ (gcs bucket)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../x.from-cloud-shell/" class="md-nav__link">
        Extra üöÄ (cloud shell)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2.gce/" class="md-nav__link">
        Lab 2Ô∏è‚É£ (GCE)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../3.gke/" class="md-nav__link">
        Lab 3Ô∏è‚É£ (GKE)
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Lab 4Ô∏è‚É£ (CloudRun üèÉ‚Äç‚ôÇÔ∏è)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Lab 4Ô∏è‚É£ (CloudRun üèÉ‚Äç‚ôÇÔ∏è)
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#benefits-features" class="md-nav__link">
    Benefits &amp; Features
  </a>
  
    <nav class="md-nav" aria-label="Benefits &amp; Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#container-to-production-in-seconds" class="md-nav__link">
    Container to production in seconds
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fully-managed" class="md-nav__link">
    Fully managed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enhanced-developer-experience" class="md-nav__link">
    Enhanced developer experience
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#any-language-any-library-any-binary" class="md-nav__link">
    Any language, any library, any binary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leverage-container-workflows-and-standards" class="md-nav__link">
    Leverage container workflows and standards
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payperuse" class="md-nav__link">
    Pay‚Äêper‚Äêuse
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fast-autoscaling" class="md-nav__link">
    Fast autoscaling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redundancy" class="md-nav__link">
    Redundancy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integrated-logging-and-monitoring" class="md-nav__link">
    Integrated logging and monitoring
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../5.app-engine/" class="md-nav__link">
        Lab 5Ô∏è‚É£ (App Engine)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#benefits-features" class="md-nav__link">
    Benefits &amp; Features
  </a>
  
    <nav class="md-nav" aria-label="Benefits &amp; Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#container-to-production-in-seconds" class="md-nav__link">
    Container to production in seconds
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fully-managed" class="md-nav__link">
    Fully managed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enhanced-developer-experience" class="md-nav__link">
    Enhanced developer experience
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#any-language-any-library-any-binary" class="md-nav__link">
    Any language, any library, any binary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leverage-container-workflows-and-standards" class="md-nav__link">
    Leverage container workflows and standards
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payperuse" class="md-nav__link">
    Pay‚Äêper‚Äêuse
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fast-autoscaling" class="md-nav__link">
    Fast autoscaling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redundancy" class="md-nav__link">
    Redundancy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integrated-logging-and-monitoring" class="md-nav__link">
    Integrated logging and monitoring
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <p>Under Construction üöß</p>
<!-- # should it be Cloud Run instead?

https://cloud.google.com/run/docs/quickstarts/build-and-deploy/python

https://medium.com/the-node-js-collection/time-to-hello-world-part3-gke-9ca38e55eb6d
https://medium.com/google-cloud/knative-to-cloud-run-f0ed1617e256
-->

<h1 id="cloud-run">Cloud Run<a class="headerlink" href="#cloud-run" title="Permanent link">&para;</a></h1>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Develop and deploy highly scalable containerized applications on a fully managed serverless platform.
- Write code your way using your favorite languages (Go, Python, Java, Ruby, Node.js, and more)
- Abstract away all infrastructure management for a simple developer experience
- Built upon the container and Knative open standards, enabling  portability of your applications</p>
</div>
<h2 id="benefits-features">Benefits &amp; Features<a class="headerlink" href="#benefits-features" title="Permanent link">&para;</a></h2>
<h3 id="container-to-production-in-seconds">Container to production in seconds<a class="headerlink" href="#container-to-production-in-seconds" title="Permanent link">&para;</a></h3>
<p>Write code your way by deploying any code or container that listens for requests or events. Build applications in your favorite language, with your favorite dependencies and tools, and deploy them in seconds.</p>
<h3 id="fully-managed">Fully managed<a class="headerlink" href="#fully-managed" title="Permanent link">&para;</a></h3>
<p>Cloud Run abstracts away all infrastructure management by automatically scaling up and down from zero almost instantaneously‚Äîdepending on traffic. Cloud Run only charges you for the exact resources you use.</p>
<h3 id="enhanced-developer-experience">Enhanced developer experience<a class="headerlink" href="#enhanced-developer-experience" title="Permanent link">&para;</a></h3>
<p>Cloud Run makes app development and deployment simpler and faster. And it‚Äôs fully integrated with Cloud Code, Cloud Build, Cloud Monitoring, and Cloud Logging for an enhanced end-to-end developer experience.</p>
<h3 id="any-language-any-library-any-binary">Any language, any library, any binary<a class="headerlink" href="#any-language-any-library-any-binary" title="Permanent link">&para;</a></h3>
<p>Use the programming language of your choice, any language or operating system libraries, or even bring your own binaries.</p>
<h3 id="leverage-container-workflows-and-standards">Leverage container workflows and standards<a class="headerlink" href="#leverage-container-workflows-and-standards" title="Permanent link">&para;</a></h3>
<p>Containers have become a standard to package and deploy code and its dependencies. Cloud Run pairs great with the container ecosystem: Cloud Build, Cloud Code, Artifact Registry, and Docker.</p>
<h3 id="payperuse">Pay‚Äêper‚Äêuse<a class="headerlink" href="#payperuse" title="Permanent link">&para;</a></h3>
<p>Only pay when your code is running, billed to the nearest 100 milliseconds.</p>
<h3 id="fast-autoscaling">Fast autoscaling<a class="headerlink" href="#fast-autoscaling" title="Permanent link">&para;</a></h3>
<p>Cloud Run automatically scales up or down from zero to N depending on traffic.</p>
<h3 id="redundancy">Redundancy<a class="headerlink" href="#redundancy" title="Permanent link">&para;</a></h3>
<p>Cloud Run services are regional, automatically replicated across multiple zones.</p>
<h3 id="integrated-logging-and-monitoring">Integrated logging and monitoring<a class="headerlink" href="#integrated-logging-and-monitoring" title="Permanent link">&para;</a></h3>
<p>Out-of-the-box integration with Cloud Monitoring, Cloud Logging, Cloud Trace, and Error Reporting to ensure the health of an application.</p>
<blockquote>
<p>some <a href="https://cloud.google.com/run#section-6">uses cases</a></p>
</blockquote>
<hr />
<h1 id="what-you-will-learn-in-this-lab">What you will learn in this lab<a class="headerlink" href="#what-you-will-learn-in-this-lab" title="Permanent link">&para;</a></h1>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> What is Cloud Run.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> What you need to deploy and run your workloads to CloudRun.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Build and Run on CloudRun</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Deploying an existing container image to CloudRun</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Do a Blue/Green deployment</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Knative == CloudRun?</li>
</ul>
<!-- - [x] How to IaC in Cloud Run using Knative.
- [x] Extensible options for Knative. -->

<h1 id="things-you-need">Things you need<a class="headerlink" href="#things-you-need" title="Permanent link">&para;</a></h1>
<ul>
<li>Dockerfile</li>
<li>sample source code.</li>
</ul>
<h1 id="build-and-run-on-cloudrun">Build and Run on CloudRun<a class="headerlink" href="#build-and-run-on-cloudrun" title="Permanent link">&para;</a></h1>
<p>In Cloud Shell run the following commands:</p>
<p>Clone the repo:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>git clone https://github.com/kontinu/gcp-bootcamp.git
cd gcp-bootcamp
</code></pre></div>
</td></tr></table></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>gsutil mb -l us-east1 gs://${GOOGLE_CLOUD_PROJECT}_cloudbuild

cd src/python

gcloud run deploy --region=us-east1 --tag main &lt;your-name&gt;-app
</code></pre></div>
</td></tr></table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>fill out the prompted questions accordingly.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>This command is equivalent to running `gcloud builds submit --tag [IMAGE] /home/cloud_user_p_264ad208/gcp-bootcamp/src/python` and `gcloud run deploy marcos-app --image [IMAGE]`
</code></pre></div>
</td></tr></table></p>
</div>
<h1 id="deploying-an-existing-container-image-to-cloudrun">Deploying an existing container image to CloudRun<a class="headerlink" href="#deploying-an-existing-container-image-to-cloudrun" title="Permanent link">&para;</a></h1>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>cd ~/gcp-bootcamp

export LD_LIBRARY_PATH=/usr/local/lib

gcloud auth configure-docker us-east1-docker.pkg.dev

gcloud artifacts repositories create python-gcp --location=us-east1 --repository-format=docker


export version=1.0
export color=blue
docker-compose build

docker-compose push

gcloud run deploy &lt;your-name&gt;-my-app --region=us-east1 --tag $color --image=us-east1-docker.pkg.dev/${GOOGLE_CLOUD_PROJECT}/python-gcp/app:v${version}
</code></pre></div>
</td></tr></table>
<h1 id="blue-green-deployment">Blue üîµ  Green üü¢ Deployment<a class="headerlink" href="#blue-green-deployment" title="Permanent link">&para;</a></h1>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>cd ~/gcp-bootcamp
export LD_LIBRARY_PATH=/usr/local/lib

# Deploy BLUE VERSION
export color=blue
export version=1.0
docker-compose build

docker-compose push

gcloud run deploy &lt;your-name&gt;-rollout-app --allow-unauthenticated --region=us-east1 --tag $color --image=us-east1-docker.pkg.dev/${GOOGLE_CLOUD_PROJECT}/python-gcp/app:v${version}

# Deploy GREEN VERSION
export color=green
export version=2.0
docker-compose build

docker-compose push

gcloud run deploy &lt;your-name&gt;-rollout-app --allow-unauthenticated --region=us-east1 --tag $color  --no-traffic --image=us-east1-docker.pkg.dev/${GOOGLE_CLOUD_PROJECT}/python-gcp/app:v${version}


# update traffic
gcloud run services update-traffic rollout-app --to-tags green=1
</code></pre></div>
</td></tr></table>
<details class="help"><summary>Help</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>gcloud run deploy [[SERVICE] --namespace=NAMESPACE] [--args=[ARG,...]]
        [--async] [--command=[COMMAND,...]] [--concurrency=CONCURRENCY]
        [--cpu=CPU] [--ingress=INGRESS; default=&quot;all&quot;]
        [--max-instances=MAX_INSTANCES] [--memory=MEMORY]
        [--min-instances=MIN_INSTANCES]
        [--platform=PLATFORM; default=&quot;managed&quot;] [--port=PORT]
        [--service-account=SERVICE_ACCOUNT] [--tag=TAG] [--timeout=TIMEOUT]
        [--no-traffic] [--[no-]use-http2]
        [--clear-env-vars | --set-env-vars=[KEY=VALUE,...]
        | --remove-env-vars=[KEY,...] --update-env-vars=[KEY=VALUE,...]]
        [--clear-labels | --remove-labels=[KEY,...] --labels=[KEY=VALUE,...]
        | --update-labels=[KEY=VALUE,...]]
        [--clear-secrets | --set-secrets=[KEY=VALUE,...]
        | --remove-secrets=[KEY,...] --update-secrets=[KEY=VALUE,...]]
        [--connectivity=CONNECTIVITY --clear-config-maps
        | --set-config-maps=[KEY=VALUE,...] | --remove-config-maps=[KEY,...]
        --update-config-maps=[KEY=VALUE,...]]
        [--image=IMAGE | --source=SOURCE]
        [--[no-]allow-unauthenticated --breakglass=JUSTIFICATION
        --clear-vpc-connector --revision-suffix=REVISION_SUFFIX
        --vpc-connector=VPC_CONNECTOR --vpc-egress=VPC_EGRESS
        --add-cloudsql-instances=[CLOUDSQL-INSTANCES,...]
        | --clear-cloudsql-instances
        | --remove-cloudsql-instances=[CLOUDSQL-INSTANCES,...]
        | --set-cloudsql-instances=[CLOUDSQL-INSTANCES,...]
        --binary-authorization=POLICY
        | --clear-binary-authorization --clear-key
        | --key=KEY --clear-post-key-revocation-action-type
        | --post-key-revocation-action-type=POST_KEY_REVOCATION_ACTION_TYPE]
        [--region=REGION
        | --cluster=CLUSTER --cluster-location=CLUSTER_LOCATION
        | --context=CONTEXT --kubeconfig=KUBECONFIG] [GCLOUD_WIDE_FLAG ...]
</code></pre></div>
</td></tr></table>
</details>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: 2021-10-07
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../3.gke/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Lab 3Ô∏è‚É£ (GKE)" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Lab 3Ô∏è‚É£ (GKE)
            </div>
          </div>
        </a>
      
      
        
        <a href="../5.app-engine/" class="md-footer__link md-footer__link--next" aria-label="Next: Lab 5Ô∏è‚É£ (App Engine)" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Lab 5Ô∏è‚É£ (App Engine)
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 Marcos Cano
          </div>
        
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.e99e714c.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.bc35569b.min.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
        <script src="../static/js/asciinema-player.js"></script>
      
    
  </body>
</html>